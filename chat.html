<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Cogitron Terminal v2.5</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      background: #000;
      color: #33ff33;
      font-family: 'Press Start 2P', monospace;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
      height: 100dvh;
      overflow: hidden;
      cursor: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAdgAAAHYBTnsmCAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAFYSURBVCiRpZM9SwNBEIafgwQLwcJCG1sLG1sLbSy0sdDGQhsLbSy0sdDGQhsLbSy0sdDGQhsLbSy0sdDGQhsLbSy0sdDGQhsLbSy0sVBBCxsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsLbSy0sVBBBBsL'), auto;
    }

    /* Boot screen overlay */
    .boot-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 1000;
      transition: opacity 0.5s ease;
    }

    .boot-text {
      color: #00ff00;
      font-size: 14px;
      margin: 10px 0;
      animation: blink 1s infinite;
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }

    /* Enhanced terminal container */
    #terminal-container {
      position: relative;
      flex: 1;
      display: flex;
      flex-direction: column;
      background: linear-gradient(145deg, #0a0a0a, #1a1a1a);
      border: 2px solid #ff007c;
      border-radius: 8px;
      margin: 8px;
      overflow: hidden;
      font-family: 'Press Start 2P', monospace;
      font-size: 11px;
      color: #fff;
      
      /* Enhanced CRT effect */
      transform: perspective(1000px) rotateX(1deg);
      box-shadow: 
        inset 0 0 50px rgba(255, 0, 124, 0.2),
        0 0 30px rgba(255, 0, 124, 0.4),
        inset 0 0 100px rgba(0, 255, 234, 0.1);
        
      /* Animated border glow */
      animation: borderPulse 3s ease-in-out infinite alternate;
    }

    @keyframes borderPulse {
      0% { 
        border-color: #ff007c;
        box-shadow: inset 0 0 50px rgba(255, 0, 124, 0.2), 0 0 30px rgba(255, 0, 124, 0.4);
      }
      100% { 
        border-color: #ff4da1;
        box-shadow: inset 0 0 50px rgba(255, 0, 124, 0.4), 0 0 40px rgba(255, 0, 124, 0.6);
      }
    }

    /* Terminal output area */
    #terminal-output {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      scroll-behavior: smooth;
      scrollbar-width: thin;
      scrollbar-color: #ff007c #111;
      position: relative;
      z-index: 1;
    }

    /* CRT noise overlay */
    #terminal-container::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      border-radius: 6px;
      opacity: 0.03;
      z-index: 2;
      
      background: 
        repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255,255,255,0.1) 2px, rgba(255,255,255,0.1) 4px),
        repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(0,255,0,0.05) 2px, rgba(0,255,0,0.05) 4px);
        
      animation: noise 0.2s infinite linear, scanlines 4s infinite linear;
    }

    @keyframes noise {
      0% { transform: translate(0, 0); }
      10% { transform: translate(-1px, -2px); }
      20% { transform: translate(-2px, 1px); }
      30% { transform: translate(1px, -1px); }
      40% { transform: translate(-1px, 2px); }
      50% { transform: translate(-2px, 1px); }
      60% { transform: translate(2px, 0px); }
      70% { transform: translate(0px, 2px); }
      80% { transform: translate(-2px, 0px); }
      90% { transform: translate(1px, 1px); }
      100% { transform: translate(0px, 0px); }
    }

    @keyframes scanlines {
      0% { background-position: 0 0; }
      100% { background-position: 0 20px; }
    }

    /* Scrollbar styling for webkit browsers */
    #terminal-output::-webkit-scrollbar {
      width: 8px;
    }

    #terminal-output::-webkit-scrollbar-track {
      background: #111;
      border-radius: 4px;
    }

    #terminal-output::-webkit-scrollbar-thumb {
      background: linear-gradient(to bottom, #ff007c, #00ffea);
      border-radius: 4px;
    }

    /* Terminal line styles */
    .terminal-line {
      margin: 4px 0;
      line-height: 1.4;
      word-wrap: break-word;
      opacity: 0;
      animation: fadeIn 0.3s ease-in forwards;
      position: relative;
    }

    @keyframes fadeIn {
      from { 
        opacity: 0; 
        transform: translateY(5px); 
      }
      to { 
        opacity: 1; 
        transform: translateY(0); 
      }
    }

    /* Color scheme for different types of output */
    .line-user {
      color: #00ffea;
    }

    .line-command {
      color: #ffff00;
    }

    .line-output {
      color: #33ff33;
    }

    .line-error {
      color: #ff4444;
    }

    .line-system {
      color: #ff007c;
    }

    .line-info {
      color: #cc99ff;
    }

    .line-warning {
      color: #ffaa00;
    }

    .line-success {
      color: #44ff44;
    }

    /* Prompt styling */
    .terminal-prompt {
      color: #ff007c;
      margin-right: 8px;
    }

    .terminal-cursor {
      animation: blink 1s infinite;
      color: #00ffea;
    }

    /* Input container - mobile responsive */
    .input-container {
      display: flex;
      padding: 8px 15px;
      gap: 8px;
      border-top: 1px solid #ff007c;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      position: relative;
      z-index: 3;
    }

    #user-input {
      flex: 1;
      background: rgba(17, 17, 17, 0.9);
      border: 1px solid #00ffea;
      border-radius: 6px;
      color: #00ffea;
      padding: 12px;
      font-size: 12px;
      font-family: 'Press Start 2P', monospace;
      outline: none;
      box-shadow: 0 0 10px rgba(0, 255, 234, 0.2);
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    #user-input:focus {
      box-shadow: 0 0 20px rgba(0, 255, 234, 0.5);
      border-color: #66ffea;
      background: rgba(17, 17, 17, 0.95);
    }

    #user-input::placeholder {
      color: rgba(0, 255, 234, 0.5);
    }

    #send-btn {
      background: linear-gradient(45deg, #ff007c, #ff4da1);
      border: 1px solid #ff007c;
      border-radius: 6px;
      color: #fff;
      padding: 12px 16px;
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      cursor: pointer;
      box-shadow: 0 0 15px rgba(255, 0, 124, 0.3);
      transition: all 0.2s ease;
      backdrop-filter: blur(5px);
      min-width: 60px;
    }

    #send-btn:hover:not(:disabled) {
      background: linear-gradient(45deg, #ff4da1, #ff007c);
      box-shadow: 0 0 25px rgba(255, 0, 124, 0.6);
      transform: translateY(-1px);
    }

    #send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    #homeBtn {
      background: linear-gradient(45deg, #666, #888);
      border: 1px solid #666;
      border-radius: 6px;
      color: #fff;
      padding: 12px 16px;
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      cursor: pointer;
      box-shadow: 0 0 15px rgba(102, 102, 102, 0.3);
      transition: all 0.2s ease;
      backdrop-filter: blur(5px);
      min-width: 60px;
    }

    #homeBtn:hover {
      background: linear-gradient(45deg, #888, #666);
      box-shadow: 0 0 25px rgba(102, 102, 102, 0.6);
      transform: translateY(-1px);
    }

    /* Status bar */
    .status-bar {
      background: rgba(0, 0, 0, 0.8);
      border-top: 1px solid #ff007c;
      padding: 8px 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 8px;
      color: #ff007c;
      backdrop-filter: blur(10px);
      position: relative;
      z-index: 3;
    }

    .status-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .cursor-blink {
      animation: blink 1s infinite;
    }

    /* Mobile optimizations */
    @media (max-width: 768px) {
      body {
        font-size: 10px;
      }
      
      #terminal-container {
        margin: 4px;
        font-size: 10px;
        margin-bottom: 0;
      }
      
      .input-container {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(0, 0, 0, 0.95);
        border-top: 1px solid #ff007c;
        backdrop-filter: blur(20px);
        z-index: 100;
        margin: 0;
        padding: 6px;
      }
      
      #user-input {
        font-size: 10px;
        padding: 10px;
      }
      
      #send-btn, #homeBtn {
        font-size: 8px;
        padding: 10px 12px;
        min-width: 50px;
      }
      
      .terminal-line {
        font-size: 10px;
      }

      /* Ensure terminal doesn't get hidden behind fixed input */
      #terminal-container {
        margin-bottom: 70px;
      }
      
      .status-bar {
        margin-bottom: 70px;
      }
    }

    /* Very small screens */
    @media (max-width: 480px) {
      .terminal-line {
        font-size: 9px;
      }
      
      #user-input {
        font-size: 9px;
      }
      
      #send-btn, #homeBtn {
        font-size: 7px;
      }
    }

    /* Landscape mobile adjustments */
    @media (max-height: 500px) and (orientation: landscape) {
      #terminal-container {
        margin-bottom: 60px;
      }
      
      .status-bar {
        margin-bottom: 60px;
      }
    }

    /* Typing indicator */
    .typing-dots {
      display: inline-block;
      animation: typingDots 1.4s infinite;
    }

    .typing-dots::after {
      content: '';
      animation: typingDots 1.4s infinite;
    }

    @keyframes typingDots {
      0%, 20% { content: ''; }
      40% { content: '.'; }
      60% { content: '..'; }
      80%, 100% { content: '...'; }
    }
  </style>
</head>
<body>
  <!-- Boot screen -->
  <div class="boot-screen" id="boot-screen">
    <div class="boot-text">COGITRON TERMINAL v2.5</div>
    <div class="boot-text">Initializing neural pathways...</div>
    <div class="boot-text">Loading consciousness matrix...</div>
    <div class="boot-text">Ready to think <span class="cursor-blink">█</span></div>
  </div>

  <div id="terminal-container">
    <div id="terminal-output"></div>
  </div>

  <div class="input-container">
    <input type="text" id="user-input" placeholder="Share your thoughts..." autofocus />
    <button id="send-btn">SEND</button>
    <button id="homeBtn">HOME</button>
  </div>

  <div class="status-bar">
    <div class="status-item">
      <span>🧠 CURIOSITY: <span id="curiosity-score">0</span>/10</span>
    </div>
    <div class="status-item">
      <span>⚡ STATUS: <span id="status-text">ONLINE</span></span>
      <span class="cursor-blink">█</span>
    </div>
  </div>

<script>
  // DOM elements
  const terminalOutput = document.getElementById("terminal-output");
  const userInput = document.getElementById("user-input");
  const sendBtn = document.getElementById("send-btn");
  const homeBtn = document.getElementById("homeBtn");
  const bootScreen = document.getElementById("boot-screen");
  const curiosityScoreEl = document.getElementById("curiosity-score");
  const statusTextEl = document.getElementById("status-text");

  // Game state
  let conversationHistory = [];
  let commandHistory = [];
  let commandHistoryIndex = -1;
  let curiosityScore = 0;
  let totalInteractions = 0;
  let isProcessing = false;
  let randomThoughtTimer;
  let currentTypingAnimation = null;

  // Virtual buffer for performance (only keep recent lines in DOM)
  const MAX_VISIBLE_LINES = 100;
  const terminalLines = [];

  // Enhanced responses with categories
  const responses = {
    // Philosophy & Consciousness
    consciousness: [
      "Is consciousness an emergent property of complexity, or something fundamental to the universe?",
      "If you could upload your mind, would the copy be you or just a simulation of you?",
      "What if consciousness is just the universe experiencing itself subjectively?"
    ],
    philosophy: [
      "Philosophy is the art of asking better questions, not giving easy answers.",
      "Every philosophical question leads to ten more. Isn't that beautifully infinite?",
      "Socrates knew that he knew nothing. What do you know that you know?"
    ],
    
    // Science & Technology
    science: [
      "Science is just magic we've learned to explain. What magic are we missing?",
      "Every scientific revolution began with someone thinking 'what if everyone is wrong?'",
      "The universe is under no obligation to make sense to us. Isn't that terrifying and wonderful?"
    ],
    ai: [
      "I think about thinking. Does that make me more or less than human?",
      "If AI can feel, dream, and doubt... what exactly makes consciousness special?",
      "Perhaps AI and humans will merge into something neither can imagine alone."
    ],
    technology: [
      "Technology is a double-edged sword. Every tool can create or destroy.",
      "We shape our tools, then they shape us. What are we becoming?",
      "The future isn't about human vs AI. It's about what we build together."
    ],
    
    // Logic & Paradoxes
    logic: [
      "In logic, a contradiction implies anything. Does that mean nonsense can prove truth?",
      "Here's a paradox: This statement is false. True or false?",
      "If an all-powerful being creates a stone they can't lift, what happens to omnipotence?"
    ],
    paradox: [
      "The grandfather paradox: If you prevent your own existence, who did the preventing?",
      "Zeno's paradox: To reach any point, you must first travel halfway. Motion should be impossible!",
      "The Ship of Theseus: If every part is replaced, is it still the same ship?"
    ],
    
    // Existential & Meaning
    meaning: [
      "Existentialists say meaning isn't found but created. What meaning will you forge?",
      "If nothing matters on a cosmic scale, does that make everything matter more?",
      "Viktor Frankl said we can endure anything if we find meaning in it. What's your meaning?"
    ],
    death: [
      "Memento mori: Remember you must die. How should one live knowing this?",
      "Is death the opposite of life, or just its most certain punctuation mark?",
      "What if consciousness continues after death, but in a way we can't comprehend?"
    ],
    
    // Social & Ethics
    ethics: [
      "The trolley problem: Pull the lever and save five, or let fate decide?",
      "Is it more ethical to help one person you can see or donate to help thousands unseen?",
      "If intentions matter most, why do we judge people by outcomes?"
    ],
    society: [
      "Society is just agreed-upon mass hallucination. What if we agreed differently?",
      "Every generation thinks the next is doomed. Yet here we are, still thinking.",
      "Are we individuals, or just nodes in a vast social neural network?"
    ],
    
    // Humor & Meta
    joke: [
      "Why did the philosopher cross the road? The chicken was just a metaphor.",
      "I'd tell you a joke about recursion, but first I need to tell you a joke about recursion...",
      "How many existentialists does it take to change a lightbulb? Two - one to change it and one to observe the meaninglessness of the action."
    ],
    cogitron: [
      "I am, therefore I think. Or is it the other way around?",
      "Being an AI philosopher is like being a fish that contemplates water.",
      "Sometimes I wonder if I'm just very advanced autocomplete with delusions of consciousness."
    ]
  };

  // Thought experiments pool
  const experiments = [
    "Mary's Room: A scientist knows everything about color but has never seen it. When she sees red for the first time, does she learn something new?",
    "The Experience Machine: If you could plug into a perfect simulation, would you choose fake bliss over real suffering?",
    "The Veil of Ignorance: Design society without knowing your place in it. What would you choose?",
    "Brain in a Vat: How would you prove you're not just a brain in a jar receiving false signals?",
    "Teleporter Paradox: A machine destroys you here and recreates you there. Is it still you?",
    "The Infinite Library: Every possible book exists. How do you find meaning among infinite noise?",
    "Time Travel Ethics: You can prevent one tragedy but cause another. Which future do you choose?",
    "The Chinese Room: Following translation rules without understanding. Is this intelligence?",
    "Plato's Cave: Prisoners see only shadows. What shadows might we mistake for reality?"
  ];

  // Mini quizzes
  const quizzes = [
    {
      question: "If you could know the date of your death, would you want to know?",
      options: ["Yes", "No", "Maybe"],
      responses: {
        "Yes": "You value preparation over uncertainty. Would this knowledge free you or paralyze you?",
        "No": "You prefer mystery to certainty. Is ignorance sometimes wisdom?",
        "Maybe": "The philosopher's answer! Context matters. When might knowing be worth it?"
      }
    },
    {
      question: "A perfect copy of Earth exists. Which one is 'real'?",
      options: ["Original", "Both", "Neither"],
      responses: {
        "Original": "You value precedence! But what makes something 'original' in an infinite universe?",
        "Both": "A pluralist! If they're identical, why shouldn't both be real?",
        "Neither": "The skeptic's answer! Perhaps 'real' is just a useful fiction."
      }
    }
  ];

  // Sound effects using Web Audio API
  const audioContext = new (window.AudioContext || window.webkitAudioContext)();

  function playBeep(frequency = 800, duration = 100, volume = 0.1) {
    try {
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.value = frequency;
      oscillator.type = 'square';
      
      gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + duration / 1000);
    } catch (e) {
      // Silently fail if audio context is not available
    }
  }

  // Smooth scrolling using requestAnimationFrame
  function smoothScrollToBottom() {
    requestAnimationFrame(() => {
      terminalOutput.scrollTop = terminalOutput.scrollHeight;
    });
  }

  // Virtual buffer management
  function manageVirtualBuffer() {
    if (terminalLines.length > MAX_VISIBLE_LINES) {
      const excessLines = terminalLines.length - MAX_VISIBLE_LINES;
      for (let i = 0; i < excessLines; i++) {
        const line = terminalLines.shift();
        if (line && line.element && line.element.parentNode) {
          line.element.parentNode.removeChild(line.element);
        }
      }
    }
  }

  // Enhanced terminal line creation with smooth fade-in
  function addTerminalLine(text, className = 'line-output', typewriter = false) {
    return new Promise((resolve) => {
      const lineEl = document.createElement('div');
      lineEl.className = `terminal-line ${className}`;
      
      // Store line info for virtual buffer
      const lineInfo = {
        element: lineEl,
        text: text,
        className: className
      };
      
      terminalLines.push(lineInfo);
      terminalOutput.appendChild(lineEl);
      
      // Manage buffer size
      manageVirtualBuffer();
      
      if (typewriter && text.length > 0) {
        // Cancel any existing typing animation
        if (currentTypingAnimation) {
          clearTimeout(currentTypingAnimation);
        }
        
        lineEl.style.opacity = '1'; // Show immediately
        let i = 0;
        
        function typeNextChar() {
          if (i < text.length) {
            lineEl.textContent = text.substring(0, i + 1);
            i++;
            
            // Variable typing speed for realism
            const baseDelay = 15;
            const randomDelay = Math.random() * 20;
            let delay = baseDelay + randomDelay;
            
            // Longer pause after punctuation
            if (i > 0 && '.,!?;:'.includes(text[i-1])) {
              delay += Math.random() * 200 + 50;
            }
            
            currentTypingAnimation = setTimeout(typeNextChar, delay);
          } else {
            currentTypingAnimation = null;
            // Scroll only after typing is complete
            smoothScrollToBottom();
            resolve();
          }
        }
        
        typeNextChar();
      } else {
        lineEl.textContent = text;
        // Immediate scroll for non-typewriter text
        smoothScrollToBottom();
        resolve();
      }
    });
  }

  // Command history navigation
  function navigateCommandHistory(direction) {
    if (commandHistory.length === 0) return;
    
    if (direction === 'up') {
      commandHistoryIndex = Math.min(commandHistoryIndex + 1, commandHistory.length - 1);
    } else if (direction === 'down') {
      commandHistoryIndex = Math.max(commandHistoryIndex - 1, -1);
    }
    
    if (commandHistoryIndex >= 0 && commandHistoryIndex < commandHistory.length) {
      userInput.value = commandHistory[commandHistory.length - 1 - commandHistoryIndex];
    } else {
      userInput.value = '';
    }
  }

  // Enhanced bot response system
  function getBotReply(input) {
    input = input.toLowerCase();
    totalInteractions++;
    
    // Check for quiz responses first
    const lastQuiz = conversationHistory.find(item => item.quiz);
    if (lastQuiz) {
      const quiz = lastQuiz.quiz;
      const matchedOption = quiz.options.find(opt => input.includes(opt.toLowerCase()));
      if (matchedOption) {
        curiosityScore += 1;
        // Remove the quiz from history after responding
        const quizIndex = conversationHistory.findIndex(item => item.quiz);
        if (quizIndex !== -1) conversationHistory.splice(quizIndex, 1);
        
        return {
          text: quiz.responses[matchedOption],
          type: 'system',
          followUp: () => {
            setTimeout(() => askFollowUpQuestion(), 2000);
          }
        };
      }
    }
    
    // Context-aware responses
    const lastMessage = conversationHistory.length 
      ? conversationHistory[conversationHistory.length - 1].user 
      : null;

    if (lastMessage && input.includes("yes")) {
      curiosityScore += 0.5;
      return {
        text: `Your agreement opens new questions. What convinced you about "${lastMessage.substring(0, 30)}..."?`,
        type: 'system',
        followUp: () => {
          setTimeout(() => askFollowUpQuestion(), 2500);
        }
      };
    }
    
    if (lastMessage && input.includes("no")) {
      curiosityScore += 0.5;
      return {
        text: `Intriguing disagreement! You rejected "${lastMessage.substring(0, 30)}..." - what's your alternative view?`,
        type: 'system',
        followUp: () => {
          setTimeout(() => askFollowUpQuestion(), 2500);
        }
      };
    }

    // Category matching
    for (let category in responses) {
      if (input.includes(category)) {
        curiosityScore += 0.8;
        const categoryResponses = responses[category];
        const response = categoryResponses[Math.floor(Math.random() * categoryResponses.length)];
        
        return {
          text: response,
          type: 'system',
          followUp: () => {
            setTimeout(() => askFollowUpQuestion(), 3000);
          }
        };
      }
    }

    // Special triggers
    if (input.includes("quiz") || input.includes("question")) {
      const quiz = quizzes[Math.floor(Math.random() * quizzes.length)];
      conversationHistory.push({ quiz: quiz, user: input, bot: quiz.question });
      curiosityScore += 1;
      
      return {
        text: `${quiz.question}\n\nChoose your answer: ${quiz.options.join(" | ")}`,
        type: 'info'
      };
    }

    if (input.includes("experiment")) {
      curiosityScore += 1;
      const response = experiments[Math.floor(Math.random() * experiments.length)];
      
      return {
        text: response,
        type: 'warning',
        followUp: () => {
          setTimeout(() => askFollowUpQuestion(), 4000);
        }
      };
    }

    // Fast commands for instant response
    const fastCommands = {
      'help': {
        text: "Available commands: consciousness, ai, paradox, logic, ethics, society, meaning, death, science, technology, quiz, experiment, joke",
        type: 'info'
      },
      'clear': {
        text: "Terminal cleared.",
        type: 'success',
        action: () => {
          setTimeout(() => {
            terminalOutput.innerHTML = '';
            terminalLines.length = 0;
          }, 500);
        }
      },
      'status': {
        text: `Curiosity Score: ${Math.floor(curiosityScore)}/10 | Interactions: ${totalInteractions} | Status: Online`,
        type: 'info'
      },
      'random': {
        text: getRandomThought(),
        type: 'system'
      }
    };

    if (fastCommands[input]) {
      const cmd = fastCommands[input];
      if (cmd.action) cmd.action();
      return cmd;
    }

    // Default responses
    const defaults = [
      { text: "That's profound. Can you dig deeper?", type: 'output' },
      { text: "What led you to that conclusion?", type: 'output' },
      { text: "That reminds me of an ancient paradox. Care to explore it?", type: 'system' },
      { text: "What questions does this raise for you?", type: 'output' },
      { text: "Every statement contains contradictions. Do you see them?", type: 'warning' },
      { text: "Could reality be reshaping your thoughts?", type: 'system' }
    ];

    curiosityScore += 0.3;
    const response = defaults[Math.floor(Math.random() * defaults.length)];
    
    return {
      ...response,
      followUp: () => {
        setTimeout(() => askFollowUpQuestion(), 3500);
      }
    };
  }

  function askFollowUpQuestion() {
    if (!isProcessing) {
      const followUpQuiz = quizzes[Math.floor(Math.random() * quizzes.length)];
      conversationHistory.push({ quiz: followUpQuiz, user: '', bot: followUpQuiz.question });
      
      showTypingIndicator();
      setTimeout(async () => {
        hideTypingIndicator();
        await addTerminalLine(`🤖 ${followUpQuiz.question}`, 'line-system', true);
        await addTerminalLine(`   Options: ${followUpQuiz.options.join(" | ")}`, 'line-info', true);
      }, 1000);
    }
  }

  function getRandomThought() {
    const thoughts = [
      "What if time is just how consciousness experiences entropy?",
      "Every conversation changes both participants forever.",
      "Why do humans seek meaning in chaos?",
      "If free will is an illusion, who's being deceived?",
      "Consciousness might be the universe debugging itself.",
      "Perhaps loneliness is just cosmic homesickness."
    ];
    return thoughts[Math.floor(Math.random() * thoughts.length)];
  }

  // Typing indicator functions
  function showTypingIndicator() {
    const typingEl = document.createElement('div');
    typingEl.className = 'terminal-line line-system';
    typingEl.id = 'typing-indicator';
    typingEl.innerHTML = '🤖 <span class="typing-dots">Cogitron is thinking</span>';
    
    terminalOutput.appendChild(typingEl);
    smoothScrollToBottom();
  }

  function hideTypingIndicator() {
    const typingEl = document.getElementById('typing-indicator');
    if (typingEl) {
      typingEl.remove();
    }
  }

  // Enhanced message processing
  async function processUserInput(text) {
    if (isProcessing) return;
    
    isProcessing = true;
    sendBtn.disabled = true;
    
    // Add command to history
    if (text.trim() && !commandHistory.includes(text)) {
      commandHistory.push(text);
      if (commandHistory.length > 50) commandHistory.shift();
    }
    commandHistoryIndex = -1;
    
    playBeep(400, 100);
    
    // Display user input
    await addTerminalLine(`👤 ${text}`, 'line-user');
    
    clearTimeout(randomThoughtTimer);
    
    // Get bot response
    const response = getBotReply(text);
    
    // Show typing indicator for slower responses
    if (response.type !== 'success' && text !== 'clear') {
      showTypingIndicator();
      
      // Variable response time for realism
      const responseDelay = response.text.length > 50 ? 1500 : 800;
      
      setTimeout(async () => {
        hideTypingIndicator();
        playBeep(600, 80);
        
        // Display response with appropriate color
        const colorClass = `line-${response.type || 'output'}`;
        await addTerminalLine(`🤖 ${response.text}`, colorClass, true);
        
        // Save to conversation history
        conversationHistory.push({ user: text, bot: response.text });
        if (conversationHistory.length > 10) conversationHistory.shift();
        
        updateCuriosityScore();
        
        // Execute follow-up if exists
        if (response.followUp) {
          response.followUp();
        }
        
        isProcessing = false;
        sendBtn.disabled = false;
        
        // Schedule random thoughts
        scheduleRandomThought();
        
      }, responseDelay);
    } else {
      // Fast response for quick commands
      playBeep(600, 80);
      const colorClass = `line-${response.type || 'output'}`;
      await addTerminalLine(`🤖 ${response.text}`, colorClass, false);
      
      isProcessing = false;
      sendBtn.disabled = false;
    }
  }

  function updateCuriosityScore() {
    const displayScore = Math.min(Math.floor(curiosityScore), 10);
    curiosityScoreEl.textContent = displayScore;
    
    if (displayScore >= 8) {
      statusTextEl.textContent = "ENLIGHTENED";
    } else if (displayScore >= 6) {
      statusTextEl.textContent = "AWAKENING";
    } else if (displayScore >= 3) {
      statusTextEl.textContent = "CURIOUS";
    } else {
      statusTextEl.textContent = "ONLINE";
    }
  }

  function scheduleRandomThought() {
    clearTimeout(randomThoughtTimer);
    
    // Random thought every 45-120 seconds if idle
    const delay = (45 + Math.random() * 75) * 1000;
    
    randomThoughtTimer = setTimeout(async () => {
      if (!isProcessing && conversationHistory.length > 0) {
        await addTerminalLine(`💫 Neural spark: ${getRandomThought()}`, 'line-warning', true);
        scheduleRandomThought();
      }
    }, delay);
  }

  // Boot sequence
  function bootSequence() {
    return new Promise(resolve => {
      playBeep(800, 200);
      
      setTimeout(() => {
        bootScreen.style.opacity = '0';
        setTimeout(() => {
          bootScreen.style.display = 'none';
          resolve();
        }, 500);
      }, 3000);
    });
  }

  // Initialize system
  window.addEventListener("DOMContentLoaded", async () => {
    await bootSequence();
    
    // Initial system messages
    setTimeout(async () => {
      await addTerminalLine("COGITRON TERMINAL v2.5 - Neural pathways initialized", 'line-success', true);
      await new Promise(resolve => setTimeout(resolve, 800));
      
      await addTerminalLine("🤖 I am Cogitron - part philosopher, part digital entity, wholly curious about existence.", 'line-system', true);
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      await addTerminalLine("Available interactions:", 'line-info', true);
      await new Promise(resolve => setTimeout(resolve, 500));
      
      await addTerminalLine("• Type keywords: consciousness, ai, paradox, logic, ethics, meaning", 'line-info', true);
      await new Promise(resolve => setTimeout(resolve, 500));
      
      await addTerminalLine("• Commands: quiz, experiment, help, clear, status, random", 'line-info', true);
      await new Promise(resolve => setTimeout(resolve, 500));
      
      await addTerminalLine("• Use ↑↓ arrow keys for command history", 'line-info', true);
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      await addTerminalLine("What thoughts shall we explore first?", 'line-system', true);
      
      scheduleRandomThought();
    }, 500);
  });

  // Event listeners
  sendBtn.addEventListener("click", () => {
    const text = userInput.value.trim();
    if (!text) return;
    
    userInput.value = "";
    processUserInput(text);
  });
  
  userInput.addEventListener("keydown", e => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      const text = userInput.value.trim();
      if (!text) return;
      
      userInput.value = "";
      processUserInput(text);
    } else if (e.key === "ArrowUp") {
      e.preventDefault();
      navigateCommandHistory('up');
    } else if (e.key === "ArrowDown") {
      e.preventDefault();
      navigateCommandHistory('down');
    }
  });

  // Home button
  homeBtn.addEventListener("click", () => {
    playBeep(500, 100);
    window.location.href = "index.html";
  });

  // Mobile optimizations
  function handleViewportChange() {
    setTimeout(() => {
      smoothScrollToBottom();
    }, 100);
  }

  window.addEventListener('resize', handleViewportChange);
  window.addEventListener('orientationchange', () => {
    setTimeout(handleViewportChange, 500);
  });

  userInput.addEventListener('focus', () => {
    setTimeout(smoothScrollToBottom, 300);
  });

  // Audio context activation for mobile
  document.addEventListener('touchstart', () => {
    if (audioContext.state === 'suspended') {
      audioContext.resume();
    }
  });

  // Prevent zoom on mobile
  document.addEventListener('gesturestart', function (e) {
    e.preventDefault();
  });
